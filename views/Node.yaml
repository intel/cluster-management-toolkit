kind: Node
default_command: nodes
command:
- "no"
listview:
  name: Nodes
  group: Core
  field_indexes:
    Wide: [name, status, roles, age, kubelet_version, internal_ips, os, kernel_version, container_runtime, cpu, mem, taints]
    Normal: [name, status, roles, age, kubelet_version, internal_ips, cpu, mem, taints]
  fields:
    container_runtime:
      header: "Container-Runtime:"
      path: "status#nodeInfo#containerRuntimeVersion"
      type: str
    cpu:
      header: "CPUs:"
      paths:
      - path: [["status#allocatable#cpu"], ["status#capacity#cpu"]]
        pathtype: tuple
        type: [raw, raw]
      formatter: list
      formatting:
        field_colors:
        - type: numerical
        - type: numerical
        field_separator:
        - type: fraction
      align: right
    internal_ips:
      header: "Internal-IPs:"
      paths:
      - path: "status#addresses"
        pathtype: items
        subpath: address
        when:
          key: type
          eq: InternalIP
        default: "<unset>"
      formatter: list
      formatting:
        ellipsise: 3
    kernel_version:
      header: "Kernel Version:"
      path: "status#nodeInfo#kernelVersion"
      type: version
    kubelet_version:
      header: "Version:"
      path: "status#nodeInfo#kubeletVersion"
      type: version
    os:
      header: "OS-Image:"
      path: "status#nodeInfo#osImage"
      type: str
    roles:
      header: "Roles:"
      paths:
      - path: ["metadata#labels"]
        pathtype: key_value
        when:
        - key_startswith: node-role.kubernetes.io
        key:
          transform:
            "node-role.kubernetes.io/master": "node-role.kubernetes.io/control-plane"
          regex: ["^[^/]*/(.*)"]
      formatter: list
    status:
      header: "Status:"
      paths:
      - path: "status#conditions"
        pathtype: substitution
        subpath: status
        when:
        - key: type
          eq: Ready
        - key: status
          eq: "True"
        substitute: Ready
      default: "Not Ready"
      formatter: value_mapper
      formatting:
        mapping:
          mappings:
            Ready:
              field_colors:
              - context: main
                type: status_ok
            Not Ready:
              field_colors:
              - context: main
                type: status_not_ok
    taints:
      header: "Taints:"
      paths:
      - path: ["spec#taints"]
        pathtype: items
        subpaths:
        - subpath: key
          transform:
            "node-role.kubernetes.io/master": "node-role.kubernetes.io/control-plane"
          regex: ["^[^/]*/(.*)"]
        - effect
      formatter: list
      formatting:
        field_colors:
        - type: key
        - type: value
        field_separators:
        - type: keyvalue
        mapping:
          mappings:
            NoSchedule:
              field_colors:
              - context: main
                type: status_not_ok
            PreferNoSchedule:
              field_colors:
              - context: main
                type: status_warning
            NoExecute:
              field_colors:
              - context: main
                type: status_not_ok
  actions:
    playbooklist:
      context: node
  shortcuts:
    "SSH to host":
      key: s
      modifier: shift
      helptext: SSH to host
      action: call
      action_call: ssh_to_host
      action_args:
        _pass_selected: true
